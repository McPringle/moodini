<!DOCTYPE html>

<html lang="en">
    <head>
        <meta charset="UTF-8" />
        <title>Moodini</title>
        <script src="bower_components/jquery/dist/jquery.min.js"></script>
        <style>
            body {
                background-color: black;
                color: #48B7E2;
                font-family: sans-serif;
            }
            main {
                bottom: 1em;
                border-color: #48B7E2;
                border-radius: 3em;
                border-style: solid;
                left: 1em;
                padding: 1em;
                position: absolute;
                right: 1em;
                top: 1em;
            }
            div#header {
                background-image: url("images/moodini.svg");
                background-position: center center;
                background-repeat: no-repeat;
                height: 8em;
                margin: 3em 1em 3em 1em;
            }
            div#question {
                font-size: 3em;
                margin: 3em 1em 3em 1em;
                text-align: center;
            }
            div#voting {
                box-sizing: border-box;
                text-align: center;
            }
            div#voting div {
                box-sizing: border-box;
                float: left;
                width: 20%;
            }
            div#voting a {
                background-position: center center;
                background-repeat: no-repeat;
                background-size: 60%;
                box-sizing: border-box;
                display: block;
                height: 15em;
            }
        </style>
        <script>
            var urlPrefix = window.location.href.indexOf('localhost') === -1 ? '' : 'http://localhost:8080';
            var questionId = 0;
            var votingActive = false;

            function loadLatestQuestion() {
                $.ajax({
                    url: urlPrefix + '/api/questions/latest'
                }).done(function (question) {
                    questionId = question.questionId;
                    $('#question').text(question.text);
                    votingActive = true;
                }).fail(function () {
                    alert('Error loading the latest question. Will try to fix this problem with a reload of Moodini…');
                    window.location.reload();
                });
                setTimeout(loadLatestQuestion, 60000);
            }
            $(function() {
                loadLatestQuestion();

                $('div#voting a').click(function() {
                    if (!votingActive) return;
                    votingActive = false;
                    var source = $(this);
                    var value = source.attr('data-value');
                    $.ajax({
                        url: urlPrefix + '/api/questions/' + questionId + '/votes',
                        type: 'POST',
                        data: '{"value":"' + value.toUpperCase() + '"}',
                        dataType: 'text',
                        contentType: 'application/json'
                    }).done(function(data, textStatus, jqXHR) {
                        source.animate({backgroundSize:'45%'}, 200)
                            .animate({backgroundSize:'75%'}, 200)
                            .animate({backgroundSize:'60%'}, 200);
                        setTimeout(function() {
                            votingActive = true;
                        }, 1000);
                    }).fail(function(jqXHR, textStatus, errorThrown) {
                        alert('Error while counting your vote. Will try to fix this problem with a reload of Moodini…');
                        window.location.reload();
                    });
                });
            });
        </script>
    </head>
    <body>
        <main>
            <div id="header"></div>
            <div id="question"></div>
            <div id="voting">
                <div><a href="#" style="background-image: url('images/5.svg')" data-value="Amped"></a></div>
                <div><a href="#" style="background-image: url('images/4.svg')" data-value="Good"></a></div>
                <div><a href="#" style="background-image: url('images/3.svg')" data-value="Fine"></a></div>
                <div><a href="#" style="background-image: url('images/2.svg')" data-value="Meh"></a></div>
                <div><a href="#" style="background-image: url('images/1.svg')" data-value="Pissed"></a></div>
            </div>
            <br clear="all" />
        </main>
    </body>
</html>
