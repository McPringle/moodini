language: java

sudo: false

before_cache:
  - rm -f  $HOME/.gradle/caches/modules-2/modules-2.lock
  - rm -fr $HOME/.gradle/caches/*/plugin-resolution/

cache:
  directories:
    - '$HOME/.gradle/caches'
    - '$HOME/.gradle/wrapper'
    - '$HOME/.m2/repository'
    - '$HOME/.sonar/cache'
    - '$HOME/.sonar/installs'

services:
  - docker

before_install:
  - npm install -g bower
  - bower install -p
  - docker build -t mcpringle/moodini .
  - docker login -u $DOCKER_USER -p $DOCKER_PASS
  - docker push mcpringle/moodini
  - docker logout

script:
  - ./gradlew assemble check jacocoTestReport dependencyUpdates detektCheck sonarqube -Dsonar.login=$SONAR_TOKEN
